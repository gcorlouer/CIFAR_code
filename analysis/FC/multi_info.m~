function [MI, stats] = multi_info(X, connect, varargin)

defaultMultitrial = true;
defaultConnect = 'intra';
defaultGroup = {1:size(X,1)};
defaultChans1 = 
p = inputParser;

addRequired(p,'X');
addParameter(p, 'connect', defaultConnect);
addParameter(p,'group', defaultGroup);
addParameter(p, 'multitrial', defaultMultitrial, @islogical);
addParameter(p,'chans1');
addParameter(p,'chans2');

parse(p, X, connect, varargin{:});

multitrial = p.Result.multitrial;
X = p.Result.X;
group = p.Result.group;
connect = p.Result.connect;
chans1 = p.Result.chans1;
chans2 = p.Result.chans2;

switch connect
    case 'intra'
        [MI, stats] = multi_intra_info(X, group, multitrial);
    case 'extra'
        [MI, stats] = multi_io_info(X, group, multitrial);
    case 'mutual'
        [MI, stats] = multi_mutual_info(X, chans1, chans2, multitrial);
end
end

function [MVI, stats] = multi_intra_info(X, group, multitrial)

[nchan, nobs, ntrials] = size(X);

if multitrial == true 
    V = tsdata_to_autocov(X,0);
    [MVI, stats] = cov_to_gwgmi(V,group, nobs, ntrials);
else
    
    for itrial=1:ntrials
        V(:,:,itrial) = tsdata_to_autocov(X(:,:,itrial),0);
        [MVI(:,:,itrial), stats(:,:,itrial)] = cov_to_gwgmi(V(:,:,itrial),group, nobs, 1);
    end
end
end

function [MVI, stats] = multi_io_info(X, group, multitrial)

[nchan, nobs, ntrials] = size(X);

if multitrial == true 
    V = tsdata_to_autocov(X,0);
    [MVI, stats] = cov_to_gwiomi(V,group, nobs, ntrials);
else
    
    for itrial=1:ntrials
        V(:,:,itrial) = tsdata_to_autocov(X(:,:,itrial),0);
        [MVI(:,:,itrial), stats(:,:,itrial)] = cov_to_gwiomi(V(:,:,itrial),group, nobs, 1);
    end
end
end

function [MI, stats] = multi_mutual_info(X, chans1, chans2, multitrial)
[nchan, nobs, ntrials] = size(X);

if multitrial == true 
    V = tsdata_to_autocov(X,0);
    [MI, stats] = cov_to_mvmi(V,group, nobs, ntrials);
else
    for itrial=1:ntrials
        V(:,:,itrial) = tsdata_to_autocov(X(:,:,itrial),0);
        [MI(:,:,itrial), stats(:,:,itrial)] = cov_to_mvmi(V(:,:,itrial),group, nobs, 1);
    end
end
end