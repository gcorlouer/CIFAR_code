%% Load data

datadir = fullfile('~', 'projects', 'CIFAR', 'CIFAR_data', 'iEEG_10', ... 
    'subjects', subject, 'EEGLAB_datasets', 'preproc');
fname = [subject, '_ts_visual_test.mat'];
fpath = fullfile(datadir, fname);

time_series = load(fpath);

X = time_series.data;
[nchan, nobs, ntrial, ncat] = size(X);

%% 

ROI_idx = time_series.ROI_indices;
functional_idx = time_series.functional_indices;

%%
for icat = 1:ncat
    VAR(icat) = ts_to_var_parameters(X(:,:,:,icat), 'morder', morder, 'regmode', regmode);
    disp(VAR(icat).info)
end
%%
V(icat) = VAR(icat).V;
A = VAR.A;
y=[2,3];
x=[4,6,7,8,9];
[F,pval] = var_to_mvgc(A,V,x,y,X(:,:,:,icat),regmode);